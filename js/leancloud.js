(()=>{const{leancloud:e,welcome:t}=window.AD_CONFIG;let n=0;function o(e){e||(e=window.location.pathname);let t=e.split("/");for(let e=t.length-1;e>=0;--e){let n=t[e].trim();if(n.length>0&&"/"!==n&&"index.html"!==n)return n}return"/"}if(t.interval=Math.abs(parseInt(t.interval,10))||30,(!1!==e.comment||!1!==e.count)&&function(){try{return window.AV.init(e.appid,e.appkey),!0}catch(e){return!1}}()&&(!0===e.count&&(function(){let e=new AV.Query("Counter");return new Promise(t=>{e.count().then(e=>t(e+1),e=>{console.log("Error occurs when count in leancloud.js:",e.message),t(0)})})}().then(e=>{document.querySelector("#site-count").innerHTML=e,n=e,t.enable&&function(){const e=document.querySelector("#site-layer"),o=document.querySelector("#site-layer-welcome"),i=document.querySelector("#site-layer-title");let r=parseInt(atob(window.localStorage.getItem("visit_time")),10),l=Date.now(),a=0;if(window.localStorage.setItem("visit_time",btoa(l.toString())),"none"===e.style.display&&n){if(a=Math.ceil((l-r)/864e5),isNaN(a))e.style.display="block",i.innerHTML="欢迎到来",o.innerHTML=`您是本站的第${n}位访问者`,o.style.display="flex";else{if(!(a>=t.interval))return;e.style.display="block",i.innerHTML="欢迎回来",o.innerHTML="您很久没来小站看看啦",o.style.display="flex"}window.AD_CONFIG.layer.add(()=>{i.innerHTML="",o.innerHTML="",o.style.display="none"})}}()}),function(){let e=decodeURIComponent(window.location.pathname);!e.endsWith("/")&&(e+="/");let t=new(AV.Object.extend("Counter"));t.set("visit_time",(new Date).getTime().toString()),t.set("user_agent",window.navigator.userAgent),t.set("identity_path",e),t.set("more_info",JSON.stringify(window.location));let n=new AV.ACL;n.setPublicReadAccess(!0),n.setPublicWriteAccess(!1),t.setACL(n),t.save()}()),!0===e.comment)){if(!document.querySelector("#site-comment"))return;const t=function(){const e=document.querySelector("#site-comment-info"),t=o();let n=!1;return(o=1e3)=>{n||setTimeout(()=>{n=!0;let o=new AV.Query("Comment");o.equalTo("url",t),o.count().then(t=>{e.innerHTML=`共${t}条评论`,n=!1})},o)}}();t(0),new Valine({el:"#site-comment",appId:e.appid,appKey:e.appkey,notify:!1,verify:!1,avatar:"robohash",placeholder:"正确填写邮箱, 才能及时收到回复哦♪(^∇^*)",path:o()}),document.querySelector(".vsubmit.vbtn").addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),t(1e3)})}})();